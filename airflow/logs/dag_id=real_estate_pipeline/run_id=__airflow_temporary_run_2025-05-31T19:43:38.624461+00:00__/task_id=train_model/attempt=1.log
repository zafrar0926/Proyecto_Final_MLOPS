[2025-05-31T19:44:01.077+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: real_estate_pipeline.train_model __airflow_temporary_run_2025-05-31T19:43:38.624461+00:00__ [queued]>
[2025-05-31T19:44:01.123+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: real_estate_pipeline.train_model __airflow_temporary_run_2025-05-31T19:43:38.624461+00:00__ [queued]>
[2025-05-31T19:44:01.123+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 2
[2025-05-31T19:44:01.160+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): train_model> on 2025-05-31 00:00:00+00:00
[2025-05-31T19:44:01.208+0000] {standard_task_runner.py:60} INFO - Started process 829 to run task
[2025-05-31T19:44:01.234+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'real_estate_pipeline', 'train_model', '__***_temporary_run_2025-05-31T19:43:38.624461+00:00__', '--job-id', '24', '--raw', '--subdir', 'DAGS_FOLDER/real_estate_pipeline.py', '--cfg-path', '/tmp/tmpnkcvcxc0']
[2025-05-31T19:44:01.267+0000] {standard_task_runner.py:88} INFO - Job 24: Subtask train_model
[2025-05-31T19:44:01.361+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:194 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-05-31T19:44:01.576+0000] {task_command.py:423} INFO - Running <TaskInstance: real_estate_pipeline.train_model __airflow_temporary_run_2025-05-31T19:43:38.624461+00:00__ [running]> on host 279fe042b4ac
[2025-05-31T19:44:01.957+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='real_estate_pipeline' AIRFLOW_CTX_TASK_ID='train_model' AIRFLOW_CTX_EXECUTION_DATE='2025-05-31T00:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='__***_temporary_run_2025-05-31T19:43:38.624461+00:00__'
[2025-05-31T19:44:01.965+0000] {train.py:55} INFO - Iniciando entrenamiento del modelo con GridSearch...
[2025-05-31T19:44:02.110+0000] {train.py:65} INFO - Cargando datos...
[2025-05-31T19:44:02.278+0000] {train.py:91} INFO - Iniciando GridSearch...
[2025-05-31T19:44:02.288+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.8/site-packages/joblib/parallel.py:1359 UserWarning: Loky-backed parallel loops cannot be called in a multiprocessing, setting n_jobs=1
[2025-05-31T19:44:02.288+0000] {logging_mixin.py:188} INFO - Fitting 5 folds for each of 25 candidates, totalling 125 fits
[2025-05-31T19:44:03.444+0000] {train.py:108} INFO - Mejores parámetros encontrados: {'alpha': 1.0, 'l1_ratio': 0.1}
[2025-05-31T19:44:03.449+0000] {train.py:116} INFO - Métricas del mejor modelo:
[2025-05-31T19:44:03.450+0000] {train.py:117} INFO - R2 Score: -0.010783397365085046
[2025-05-31T19:44:03.450+0000] {train.py:118} INFO - MSE: 65082589959.506546
[2025-05-31T19:44:03.451+0000] {train.py:119} INFO - MAE: 221691.14337538183
[2025-05-31T19:44:04.503+0000] {logging_mixin.py:188} WARNING - 2025/05/31 19:44:04 WARNING mlflow.utils.git_utils: Failed to import Git (the Git executable is probably not on your PATH), so Git SHA is not available. Error: Failed to initialize: Bad git executable.
The git executable must be specified in one of the following ways:
    - be included in your $PATH
    - be set via $GIT_PYTHON_GIT_EXECUTABLE
    - explicitly set via git.refresh(<full-path-to-git-executable>)

All git commands will error until this is rectified.

This initial message can be silenced or aggravated in the future by setting the
$GIT_PYTHON_REFRESH environment variable. Use one of the following values:
    - quiet|q|silence|s|silent|none|n|0: for no message or exception
    - warn|w|warning|log|l|1: for a warning message (logging level CRITICAL, displayed by default)
    - error|e|exception|raise|r|2: for a raised exception

Example:
    export GIT_PYTHON_REFRESH=quiet
[2025-05-31T19:44:18.593+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.8/site-packages/_distutils_hack/__init__.py:33 UserWarning: Setuptools is replacing distutils.
[2025-05-31T19:44:19.123+0000] {credentials.py:1147} INFO - Found credentials in environment variables.
[2025-05-31T19:44:19.501+0000] {logging_mixin.py:188} WARNING - Registered model 'real_estate_elasticnet' already exists. Creating a new version of this model...
[2025-05-31T19:44:19.551+0000] {logging_mixin.py:188} WARNING - 2025/05/31 19:44:19 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: real_estate_elasticnet, version 2
[2025-05-31T19:44:19.552+0000] {logging_mixin.py:188} WARNING - Created version '2' of model 'real_estate_elasticnet'.
[2025-05-31T19:44:19.557+0000] {logging_mixin.py:188} WARNING - 2025/05/31 19:44:19 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
[2025-05-31T19:44:22.251+0000] {local_task_job_runner.py:302} WARNING - State of this instance has been externally set to None. Terminating instance.
[2025-05-31T19:44:22.266+0000] {process_utils.py:131} INFO - Sending 15 to group 829. PIDs of all processes in the group: [860, 829]
[2025-05-31T19:44:22.270+0000] {process_utils.py:86} INFO - Sending the signal 15 to group 829
[2025-05-31T19:44:22.271+0000] {taskinstance.py:2450} ERROR - Received SIGTERM. Terminating subprocesses.
[2025-05-31T19:44:22.275+0000] {logging_mixin.py:188} WARNING - 2025/05/31 19:44:22 WARNING mlflow.utils.environment: Encountered an unexpected error while inferring pip requirements (model URI: /tmp/tmptmcskrwe/model/model.pkl, flavor: sklearn), fall back to return ['scikit-learn==1.3.2', 'cloudpickle==3.1.1']. Set logging level to DEBUG to see the full traceback.
[2025-05-31T19:44:22.484+0000] {real_estate_pipeline.py:98} ERROR - Error en el entrenamiento del modelo: DAG run not found on DAG 'real_estate_pipeline' with ID '__***_temporary_run_2025-05-31T19:43:38.624461+00:00__'
[2025-05-31T19:44:22.485+0000] {taskinstance.py:2698} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 199, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 216, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/real_estate_pipeline.py", line 93, in train_new_model
    context['task_instance'].xcom_push(key='test_r2', value=test_r2)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/utils/session.py", line 79, in wrapper
    return func(*args, session=session, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 2980, in xcom_push
    XCom.set(
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/utils/session.py", line 76, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/xcom.py", line 224, in set
    raise ValueError(f"DAG run not found on DAG {dag_id!r} with ID {run_id!r}")
ValueError: DAG run not found on DAG 'real_estate_pipeline' with ID '__***_temporary_run_2025-05-31T19:43:38.624461+00:00__'
[2025-05-31T19:44:22.529+0000] {taskinstance.py:1138} INFO - Marking task as FAILED. dag_id=real_estate_pipeline, task_id=train_model, execution_date=20250531T000000, start_date=20250531T194401, end_date=20250531T194422
[2025-05-31T19:44:22.567+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 24 for task train_model ((psycopg2.errors.ForeignKeyViolation) insert or update on table "task_fail" violates foreign key constraint "task_fail_ti_fkey"
DETAIL:  Key (dag_id, task_id, run_id, map_index)=(real_estate_pipeline, train_model, __airflow_temporary_run_2025-05-31T19:43:38.624461+00:00__, -1) is not present in table "task_instance".

[SQL: INSERT INTO task_fail (task_id, dag_id, run_id, map_index, start_date, end_date, duration) VALUES (%(task_id)s, %(dag_id)s, %(run_id)s, %(map_index)s, %(start_date)s, %(end_date)s, %(duration)s) RETURNING task_fail.id]
[parameters: {'task_id': 'train_model', 'dag_id': 'real_estate_pipeline', 'run_id': '__airflow_temporary_run_2025-05-31T19:43:38.624461+00:00__', 'map_index': -1, 'start_date': datetime.datetime(2025, 5, 31, 19, 44, 1, 79628, tzinfo=Timezone('UTC')), 'end_date': datetime.datetime(2025, 5, 31, 19, 44, 22, 528339, tzinfo=Timezone('UTC')), 'duration': 21}]
(Background on this error at: https://sqlalche.me/e/14/gkpj); 829)
[2025-05-31T19:44:22.657+0000] {process_utils.py:79} INFO - Process psutil.Process(pid=860, status='terminated', started='19:44:19') (860) terminated with exit code None
[2025-05-31T19:44:22.658+0000] {process_utils.py:79} INFO - Process psutil.Process(pid=829, status='terminated', exitcode=1, started='19:44:00') (829) terminated with exit code 1
